<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>货品管理账本</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- 角色选择 -->
        <div class="role-selector">
            <button id="role-partner" class="role-btn active">
                <i class="fas fa-user"></i> 合伙人（提交信息）
            </button>
            <button id="role-accountant" class="role-btn">
                <i class="fas fa-chart-line"></i> 记账人（查看分析）
            </button>
        </div>

        <!-- 合伙人视图：表单提交 -->
        <div id="partner-view" class="view active-view">
            <h1><i class="fas fa-box"></i> 货品信息提交</h1>
            
            <form id="goods-form">
                <div class="form-group">
                    <label for="goods-id"><i class="fas fa-barcode"></i> 货号 *</label>
                    <input type="text" id="goods-id" required 
                           placeholder="输入货号（字母数字组合），输入已有货号可自动填充">
                    <div id="suggestions" class="suggestions"></div>
                </div>
                
                <div class="form-group">
                    <label for="goods-name"><i class="fas fa-ruler"></i> 尺码/款式 *</label>
                    <input type="text" id="goods-name" required 
                           placeholder="填写尺码或款式信息">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="unit-price"><i class="fas fa-tag"></i> 拿货单价（元） *</label>
                        <input type="number" id="unit-price" step="0.01" required 
                               placeholder="0.00">
                    </div>
                    
                    <div class="form-group">
                        <label for="quantity"><i class="fas fa-cubes"></i> 数量 *</label>
                        <input type="number" id="quantity" value="1" min="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="total-cost"><i class="fas fa-calculator"></i> 总价（自动计算）</label>
                        <input type="text" id="total-cost" readonly>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="status"><i class="fas fa-list-alt"></i> 状态 *</label>
                    <select id="status" required>
                        <option value="">请选择状态</option>
                        <option value="已上架未卖出">已上架未卖出</option>
                        <option value="被退回（有瑕疵等）">被退回（有瑕疵等）</option>
                        <option value="已下架">已下架</option>
                        <option value="已卖出（退款）未到账">已卖出（退款）未到账</option>
                        <option value="已卖出（退款）已到账">已卖出（退款）已到账</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="shipping-fee"><i class="fas fa-shipping-fast"></i> 运费（元） *</label>
                    <input type="text" id="shipping-fee" required 
                           placeholder="输入数字或算式，如 3.68+3.68">
                    <small class="hint">支持算式，自动实时计算</small>
                </div>
                
                <div class="form-group">
                    <label for="shipping-note"><i class="fas fa-sticky-note"></i> 运费备注</label>
                    <input type="text" id="shipping-note" 
                           placeholder="写明运费组成">
                </div>
                
                <!-- 卖出状态时才显示的字段 -->
                <div id="sold-fields" class="hidden">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="actual-income"><i class="fas fa-money-bill-wave"></i> 实际收入/退款（元）</label>
                            <input type="number" id="actual-income" step="0.01" 
                                   placeholder="0.00">
                        </div>
                        
                        <div class="form-group">
                            <label for="profit"><i class="fas fa-chart-line"></i> 利润（自动计算）</label>
                            <input type="text" id="profit" readonly class="profit-display">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="submitter"><i class="fas fa-user-edit"></i> 提交人（选填）</label>
                    <input type="text" id="submitter" placeholder="可不填写直接提交">
                </div>
                
                <div class="form-group">
                    <label for="remark"><i class="fas fa-comment"></i> 备注</label>
                    <textarea id="remark" rows="2" placeholder="用于特殊说明"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn-submit">
                        <i class="fas fa-paper-plane"></i> 提交记录
                    </button>
                    <button type="button" id="reset-form" class="btn-reset">
                        <i class="fas fa-redo"></i> 重置表单
                    </button>
                </div>
            </form>
            
            <div id="form-message" class="message hidden"></div>
        </div>

        <!-- 记账人视图：数据查看与分析 -->
        <div id="accountant-view" class="view">
            <div class="accountant-header">
                <h1><i class="fas fa-chart-pie"></i> 账本数据分析</h1>
                
                <!-- 筛选控件 -->
                <div class="filters">
                    <div class="filter-group">
                        <label><i class="fas fa-calendar-alt"></i> 时间筛选</label>
                        <select id="time-filter">
                            <option value="all">全部时间</option>
                            <option value="today">今天</option>
                            <option value="week">本周</option>
                            <option value="month">本月</option>
                            <option value="year">今年</option>
                            <option value="custom">自定义范围</option>
                        </select>
                    </div>
                    
                    <div id="custom-date-range" class="filter-group hidden">
                        <label>从</label>
                        <input type="date" id="date-from">
                        <label>到</label>
                        <input type="date" id="date-to">
                    </div>
                    
                    <div class="filter-group">
                        <label><i class="fas fa-filter"></i> 货号筛选</label>
                        <input type="text" id="goods-id-filter" placeholder="输入货号筛选">
                    </div>
                    
                    <div class="filter-group">
                        <label><i class="fas fa-list-alt"></i> 状态筛选</label>
                        <select id="status-filter">
                            <option value="all">全部状态</option>
                            <option value="已上架未卖出">已上架未卖出</option>
                            <option value="被退回（有瑕疵等）">被退回</option>
                            <option value="已下架">已下架</option>
                            <option value="已卖出（退款）未到账">已卖出未到账</option>
                            <option value="已卖出（退款）已到账">已卖出已到账</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label><i class="fas fa-user"></i> 提交人筛选</label>
                        <input type="text" id="submitter-filter" placeholder="输入提交人筛选">
                    </div>
                    
                    <div class="filter-group">
                        <label><i class="fas fa-eye"></i> 视图模式</label>
                        <select id="view-mode">
                            <option value="timeline">时间线视图</option>
                            <option value="grouped">按货号分组</option>
                            <option value="monthly">按月汇总</option>
                        </select>
                    </div>
                    
                    <button id="apply-filters" class="btn-filter">
                        <i class="fas fa-check"></i> 应用筛选
                    </button>
                    <button id="reset-filters" class="btn-reset">
                        <i class="fas fa-redo"></i> 重置
                    </button>
                </div>
            </div>
            
            <!-- 统计信息 -->
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-list"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-value" id="total-records">0</div>
                        <div class="stat-label">总记录数</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon profit">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-value" id="total-profit">¥0.00</div>
                        <div class="stat-label">总利润</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon cost">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-value" id="total-cost-sum">¥0.00</div>
                        <div class="stat-label">总成本</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-percentage"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-value" id="avg-profit-margin">0%</div>
                        <div class="stat-label">平均利润率</div>
                    </div>
                </div>
            </div>
            
            <!-- 数据表格 -->
            <div class="table-container">
                <div class="table-header">
                    <h3><i class="fas fa-table"></i> 记录列表</h3>
                    <div class="table-actions">
                        <button id="export-data" class="btn-small">
                            <i class="fas fa-download"></i> 导出数据
                        </button>
                        <button id="refresh-data" class="btn-small">
                            <i class="fas fa-sync-alt"></i> 刷新
                        </button>
                    </div>
                </div>
                
                <div id="records-table" class="records-table">
                    <!-- 数据将通过JavaScript动态加载 -->
                    <div class="loading">加载数据中...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Supabase客户端库 -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <!-- 应用JavaScript -->
    <script src="script.js"></script>
</body>
</html>